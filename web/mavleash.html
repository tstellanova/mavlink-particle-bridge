<!DOCTYPE HTML>
<html>
<head>
<title>MAVLEASH</title>
  <style>
    html, body, #map-canvas {
      height: 400px;
      margin: 0px;
      padding: 0px
    }
  </style>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
</head>
<body>
  <table border="1">	
  <tr><td>Latitude (deg)</td><td align="right" width="70%"><span id="curLat"></span></td></tr>
  <tr><td>Longitude (deg)</td><td align="right" width="70%"><span id="curLon"></span></td></tr>
  <tr><td>Altitude AMSL (m)</td><td align="right" width="70%"><span id="curAlt"></span></td></tr>
  <tr><td>Speed (m/s)</td><td align="right" width="70%"><span id="curSpeed"></span></td></tr>
  <tr><td>Heading (deg)</td><td align="right" width="70%"><span id="curHeading"></span></td></tr>
  <tr><td>Battery (V)</td><td align="right" width="70%"><span id="curBattery"></span></td></tr>
  <tr><td>Last Msg</td><td align="right" width="70%"><span id="lastMsg"></span></td></tr>
  </table>
  <p>
  <button id="rtl_button" onclick="rtlCommand()">RTL</button>
  <button id="land_button" onclick="landCommand()">Land</button>
  >>> Last Command:<span id="lastCommand"></span></br/>
	<div id="map-canvas"></div>
  <script type="text/javascript">
    var map;
    var map_marker;
    var latitude = null;
    var longitude = null;
    
    var deviceID    = "<device id>";
    var accessToken = "<access token>";
    var reqPrefix = "https://api.particle.io/v1/devices/" + deviceID + "/";
    var reqSuffix = "/?access_token=" + accessToken;

    window.setInterval(function() {

      requestURL = reqPrefix + "latitude" + reqSuffix;
      $.getJSON(requestURL, function(json) {
        latitude = json.result;
        document.getElementById("curLat").innerHTML = json.result ;
      });
      requestURL = reqPrefix + "longitude" + reqSuffix;
      $.getJSON(requestURL, function(json) {
        longitude = json.result;
        document.getElementById("curLon").innerHTML = json.result ;
        });
      requestURL = reqPrefix + "altitude" + reqSuffix;
      $.getJSON(requestURL, function(json) {
               document.getElementById("curAlt").innerHTML = json.result ;
               });
      requestURL = reqPrefix + "groundspeed" + reqSuffix;
      $.getJSON(requestURL, function(json) {
               document.getElementById("curSpeed").innerHTML = json.result ;
               });
      requestURL = reqPrefix + "heading" + reqSuffix;
      $.getJSON(requestURL, function(json) {
               document.getElementById("curHeading").innerHTML = json.result ;
               });
      requestURL = reqPrefix + "battery_v" + reqSuffix;
      $.getJSON(requestURL, function(json) {
               document.getElementById("curBattery").innerHTML = json.result ;
               });               
      requestURL = reqPrefix + "last_msg" + reqSuffix;
      $.getJSON(requestURL, function(json) {
               document.getElementById("lastMsg").innerHTML = json.result ;
               });
      requestURL = reqPrefix + "last_cmd" + reqSuffix;
      $.getJSON(requestURL, function(json) {
               document.getElementById("lastCommand").innerHTML = json.result ;
               });
      gmapRedraw();
    }, 1000);
    
    //init google maps
    google.maps.event.addDomListener(window, 'load', gmapInit());

  function landCommand() {
    var extra = "Land";
  	var requestURL = reqPrefix + "command" + "/";
        $.post( requestURL, {params: extra, access_token: accessToken });
  }

  function rtlCommand() {
    var extra = "RTL";
  	var requestURL = reqPrefix + "command" + "/";
        $.post( requestURL, {params: extra, access_token: accessToken });
  }

  function gmapInit() {
    map = new google.maps.Map(document.getElementById('map-canvas'), {
      zoom: 15,
      center: {lat: latitude, lng : longitude, alt: 0}
    });

    map_marker = new google.maps.Marker({position: {lat: latitude, lng: longitude}, map: map});
    map_marker.setMap(map);
  }
  
  function gmapRedraw() {
    map.setCenter({lat: latitude, lng : longitude, alt: 0})
    map_marker.setPosition({lat: latitude, lng : longitude, alt: 0});
  }

    </script>
</body>
</html>